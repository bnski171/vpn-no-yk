{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - VPN Admin Panel{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
    <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
    <a href="/admin/users" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
</div>

<div class="card-grid" style="grid-template-columns: 1fr 1fr;">
    <div class="card">
        <div class="card-header">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
        
        <form method="POST" action="/admin/users/add">
            <div class="form-group">
                <label for="telegram_id">Telegram ID *</label>
                <input type="text" id="telegram_id" name="telegram_id" class="form-control" required 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456789" pattern="[0-9]{5,15}">
                <small style="color: #6c757d;">–¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, –æ—Ç 5 –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤</small>
            </div>
            
            <div class="form-group">
                <label for="server_id">–°–µ—Ä–≤–µ—Ä</label>
                <select id="server_id" name="server_id" class="form-control">
                    <option value="auto">üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                    {% for server in servers %}
                    <option value="{{ server.id }}">{{ server.name }} ({{ server.user_count }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)</option>
                    {% endfor %}
                </select>
                <small style="color: #6c757d;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –Ω–∞–∑–Ω–∞—á–∏—Ç –Ω–∞–∏–º–µ–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä</small>
            </div>
            
            <h4 style="margin: 25px 0 15px 0;">‚è∞ –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h4>
            
            <div class="form-group">
                <label for="subscription_seconds">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö</label>
                <input type="number" id="subscription_seconds" name="subscription_seconds" 
                       class="form-control" value="0" min="0" max="31536000">
                <small style="color: #6c757d;">0 = –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏, 3600 = 1 —á–∞—Å, 86400 = 1 –¥–µ–Ω—å</small>
            </div>
            
            <div style="margin-bottom: 20px;">
                <strong>–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</strong>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="setSeconds(0)">–ë–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏</button>
                    <button type="button" class="btn btn-secondary" onclick="setSeconds(3600)">1 —á–∞—Å</button>
                    <button type="button" class="btn btn-secondary" onclick="setSeconds(86400)">1 –¥–µ–Ω—å</button>
                    <button type="button" class="btn btn-secondary" onclick="setSeconds(604800)">7 –¥–Ω–µ–π</button>
                    <button type="button" class="btn btn-secondary" onclick="setSeconds(2592000)">30 –¥–Ω–µ–π</button>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button type="submit" class="btn btn-success">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <button type="reset" class="btn btn-secondary">üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            </div>
        </form>
    </div>
    
    <div class="card">
        <div class="card-header">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏</div>
        
        <div style="display: grid; gap: 15px;">
            <div style="padding: 15px; background: #e3f2fd; border-radius: 8px;">
                <strong>üì± –ö–∞–∫ —É–∑–Ω–∞—Ç—å Telegram ID?</strong><br>
                <small>
                    1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç @userinfobot –≤ Telegram<br>
                    2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start<br>
                    3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
                </small>
            </div>
            
            <div style="padding: 15px; background: #f3e5f5; border-radius: 8px;">
                <strong>‚è∞ –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏:</strong><br>
                <small>
                    ‚Ä¢ 1 –º–∏–Ω—É—Ç–∞ = 60 —Å–µ–∫—É–Ω–¥<br>
                    ‚Ä¢ 1 —á–∞—Å = 3,600 —Å–µ–∫—É–Ω–¥<br>
                    ‚Ä¢ 1 –¥–µ–Ω—å = 86,400 —Å–µ–∫—É–Ω–¥<br>
                    ‚Ä¢ 1 –Ω–µ–¥–µ–ª—è = 604,800 —Å–µ–∫—É–Ω–¥<br>
                    ‚Ä¢ 1 –º–µ—Å—è—Ü = 2,592,000 —Å–µ–∫—É–Ω–¥
                </small>
            </div>
            
            <div style="padding: 15px; background: #e8f5e8; border-radius: 8px;">
                <strong>üñ•Ô∏è –í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞:</strong><br>
                <small>
                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π. 
                    –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏.
                </small>
            </div>
            
            <div style="padding: 15px; background: #fff3e0; border-radius: 8px;">
                <strong>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong><br>
                <small>
                    –ö–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π email 
                    –∏ UUID –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN —Å–µ—Ä–≤–µ—Ä—É.
                </small>
            </div>
        </div>
    </div>
</div>

<script>
function setSeconds(seconds) {
    document.getElementById('subscription_seconds').value = seconds;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –≤—Ä–µ–º—è
    let timeStr = '';
    if (seconds === 0) {
        timeStr = '–ë–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏';
    } else if (seconds < 3600) {
        timeStr = `${Math.floor(seconds / 60)} –º–∏–Ω—É—Ç`;
    } else if (seconds < 86400) {
        timeStr = `${Math.floor(seconds / 3600)} —á–∞—Å–æ–≤`;
    } else {
        timeStr = `${Math.floor(seconds / 86400)} –¥–Ω–µ–π`;
    }
    
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
    console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${seconds} —Å–µ–∫—É–Ω–¥ (${timeStr})`);
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const telegramIdInput = document.getElementById('telegram_id');
    
    form.addEventListener('submit', function(e) {
        const telegramId = telegramIdInput.value.trim();
        
        if (!/^[0-9]{5,15}$/.test(telegramId)) {
            e.preventDefault();
            alert('Telegram ID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –±—ã—Ç—å –¥–ª–∏–Ω–æ–π –æ—Ç 5 –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤');
            telegramIdInput.focus();
            return false;
        }
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ Telegram ID
    telegramIdInput.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
    });
});
</script>
{% endblock %}